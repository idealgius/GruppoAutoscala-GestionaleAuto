{% extends "base.html" %}
{% block title %}Giacenza Gomme Clienti{% endblock %}

{% block content %}
<div class="page-container">

    <h1 class="page-title">
        <i class="fas fa-user"></i>
        <i class="fas fa-box"></i>
        Giacenza Gomme Clienti
    </h1>

    <!-- FILTRI -->
    <div class="filtri">
        <input type="text" id="filtro-nome"
               placeholder="üîç Cerca nome o cognome"
               class="filtro-input">

        <input type="text" id="filtro-targa"
               placeholder="üöó Targa (es. AB123CD)"
               maxlength="7"
               class="filtro-input">
    </div>

    {% if gomme_clienti %}
    <div id="lista-gomme-clienti">

        {% for g in gomme_clienti %}
        <div class="gomma-cliente-card"
             data-nome="{{ (g.nome ~ ' ' ~ g.cognome)|lower }}"
             data-targa="{{ g.targa|upper }}">

            <div class="card-info">
                <div class="cliente-nome">
                    {{ g.nome }} {{ g.cognome }}
                    <span class="targa">üöó {{ g.targa }}</span>
                </div>

                <div class="card-row">
                    üìÖ <strong>{{ g.data_inizio.strftime("%d/%m/%Y") }}</strong>
                </div>

                <div class="card-row">
                    üõû <strong>{{ g.marca }} {{ g.larghezza }}/{{ g.rapporto }} R{{ g.diametro }}</strong>
                </div>

                <div class="card-note">
                    üìù {{ g.note or "Nessuna nota" }}
                </div>
            </div>

            <div class="card-actions">
                <a href="{{ url_for('modifica_gommeclienti', id=g.id) }}"
                   class="action-btn btn-modifica"
                   title="Modifica">‚úèÔ∏è</a>

                <form action="{{ url_for('elimina_gommacliente', id=g.id) }}"
                      method="POST"
                      class="action-form">
                    <button type="submit"
                            class="action-btn btn-elimina"
                            title="Elimina"
                            onclick="return confirm('Eliminare questa gomma cliente?')">
                        üóëÔ∏è
                    </button>
                </form>
            </div>

        </div>
        {% endfor %}
    </div>

    {% else %}
    <p class="empty-text">Nessuna gomma cliente inserita.</p>
    {% endif %}
</div>

<style>
.page-container {
    max-width:1000px;
    margin:0 auto;
    padding:40px 20px;
}
.page-title {
    text-align:center;
    color:#006d6f;
    margin-bottom:30px;
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
}

/* FILTRI */
.filtri {
    display:flex;
    gap:15px;
    justify-content:center;
    margin-bottom:30px;
    flex-wrap:wrap;
}
.filtro-input {
    padding:8px 12px;
    border-radius:8px;
    border:1px solid #b5dada;
    min-width:220px;
    font-size:14px;
}
.filtro-input:focus {
    outline:none;
    border-color:#2bb3b1;
    box-shadow:0 0 5px rgba(43,179,177,0.4);
}

/* CARD */
#lista-gomme-clienti {
    display:flex;
    flex-direction:column;
    gap:18px;
}
.gomma-cliente-card {
    background:#f7fbfb;
    border-radius:14px;
    padding:18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 3px 8px rgba(0,0,0,0.08);
    transition:0.2s;
}
.gomma-cliente-card:hover {
    transform:translateY(-2px);
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
}

/* INFO */
.card-info {
    display:flex;
    flex-direction:column;
    gap:6px;
}
.cliente-nome {
    font-size:16px;
    font-weight:700;
    color:#004f50;
}
.targa {
    background:#e0f2f2;
    padding:3px 8px;
    border-radius:6px;
    margin-left:8px;
    font-size:13px;
}
.card-note {
    font-size:13px;
    background:#fff;
    padding:6px 10px;
    border-radius:6px;
    border:1px solid #ddeeee;
}

/* AZIONI */
.card-actions {
    display:flex;
    flex-direction:column;
    gap:10px;
}
.action-btn {
    width:38px;
    height:38px;
    border-radius:8px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:16px;
    border:none;
    text-decoration:none;
    cursor:pointer;
}
.btn-modifica {
    background:#2bb3b1;
    color:white;
}
.btn-elimina {
    background:#4aa3c7;
    color:white;
}
</style>

<script>
const filtroNome = document.getElementById("filtro-nome");
const filtroTarga = document.getElementById("filtro-targa");

filtroNome.addEventListener("input", filtra);
filtroTarga.addEventListener("input", function () {
    this.value = normalizzaTarga(this.value);
    filtra();
});

function normalizzaTarga(val) {
    val = val.toUpperCase().replace(/[^A-Z0-9]/g, '');
    let out = '';

    for (let i = 0; i < val.length && i < 7; i++) {
        const c = val[i];
        if ((i < 2 || i > 4) && /[A-Z]/.test(c)) out += c;
        else if (i >= 2 && i <= 4 && /[0-9]/.test(c)) out += c;
    }
    return out;
}

function filtra() {
    const nome = filtroNome.value.toLowerCase();
    const targa = filtroTarga.value.toUpperCase();

    document.querySelectorAll(".gomma-cliente-card").forEach(card => {
        const okNome = !nome || card.dataset.nome.includes(nome);
        const okTarga = !targa || card.dataset.targa.startsWith(targa);
        card.style.display = (okNome && okTarga) ? "flex" : "none";
    });
}
</script>

<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
{% endblock %}
