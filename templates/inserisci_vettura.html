{% extends "base.html" %}

{% block title %}Inserisci Vettura{% endblock %}

{% block content %}
<h1>ðŸš— Inserisci una nuova vettura</h1>

<form action="/salva_vettura" method="POST">
    <label for="cliente_id">ID Cliente:</label>
    <input type="number" name="cliente_id" required value="{{ request.form.get('cliente_id') or '' }}">

    <label for="modello_id">Modello:</label>
    <select name="modello_id" id="modello_id" required>
        <option value="">-- Seleziona modello --</option>
        {% for modello in modelli %}
            <option value="{{ modello.id }}"
                    data-marca="{{ modello.marca }}"
                    data-cilindrata="{{ modello.cilindrata }}"
                    data-kw="{{ modello.kw }}"
                    data-carburante="{{ modello.carburante }}">
                {{ modello.marca }} {{ modello.modello }} {% if modello.versione %}({{ modello.versione }}){% endif %}
            </option>
        {% endfor %}
    </select>

    <label for="marca">Marca:</label>
    <input type="text" name="marca" id="marca" required readonly value="{{ request.form.get('marca') or '' }}">

    <label for="modello">Modello:</label>
    <input type="text" name="modello" id="modello" required readonly value="{{ request.form.get('modello') or '' }}">

    <label for="cilindrata">Cilindrata:</label>
    <input type="text" name="cilindrata" id="cilindrata" required value="{{ request.form.get('cilindrata') or '' }}">

    <label for="kw">kW:</label>
    <input type="text" name="kw" id="kw" required value="{{ request.form.get('kw') or '' }}">

    <label for="carburante">Carburante:</label>
    <input type="text" name="carburante" id="carburante" required value="{{ request.form.get('carburante') or '' }}">

    <label for="targa">Targa:</label>
    <input type="text" name="targa" required value="{{ request.form.get('targa') or '' }}">

    <label for="telaio">Telaio:</label>
    <input type="text" name="telaio" required value="{{ request.form.get('telaio') or '' }}">

    <label for="immatricolazione">Data immatricolazione:</label>
    <input type="date" name="immatricolazione" value="{{ request.form.get('immatricolazione') or '' }}">

    <label for="km">Chilometraggio:</label>
    <input type="text" name="km" value="{{ request.form.get('km') or '' }}">

    <label for="cambio">Cambio (manuale/automatico):</label>
    <input type="text" name="cambio" value="{{ request.form.get('cambio') or '' }}">

    <button type="submit">ðŸ’¾ Salva Vettura</button>
</form>

<a class="button" href="/vetture">ðŸ”™ Torna allâ€™elenco vetture</a>

<script>
document.getElementById('modello_id').addEventListener('change', function() {
    const selected = this.options[this.selectedIndex];
    document.getElementById('marca').value = selected.dataset.marca || '';
    document.getElementById('modello').value = selected.text.split(' (')[0] || '';
    document.getElementById('cilindrata').value = selected.dataset.cilindrata || '';
    document.getElementById('kw').value = selected.dataset.kw || '';
    document.getElementById('carburante').value = selected.dataset.carburante || '';
});
</script>

{% endblock %}
