{% extends "base.html" %}

{% block title %}Inserisci Vettura{% endblock %}

{% block content %}
<h1>ðŸš— Inserisci una nuova vettura</h1>

<form action="/salva_vettura" method="POST">
    <label for="cliente_id">ID Cliente:</label>
    <input type="number" name="cliente_id" required value="{{ request.form.get('cliente_id') or '' }}">

    <label for="marca">Marca:</label>
    <select name="marca" id="marca" required>
        <option value="">-- Seleziona marca --</option>
        {% for m in marche %}
            <option value="{{ m }}">{{ m }}</option>
        {% endfor %}
    </select>

    <label for="modello_id">Modello:</label>
    <select name="modello_id" id="modello_id" required disabled>
        <option value="">-- Seleziona modello --</option>
    </select>

    <label for="targa">Targa:</label>
    <input type="text" name="targa" required value="{{ request.form.get('targa') or '' }}">

    <label for="telaio">Telaio:</label>
    <input type="text" name="telaio" required value="{{ request.form.get('telaio') or '' }}">

    <label for="immatricolazione">Data immatricolazione:</label>
    <input type="date" name="immatricolazione" value="{{ request.form.get('immatricolazione') or '' }}">

    <label for="km">Chilometraggio:</label>
    <input type="text" name="km" value="{{ request.form.get('km') or '' }}">

    <label for="cambio">Cambio (manuale/automatico):</label>
    <input type="text" name="cambio" value="{{ request.form.get('cambio') or '' }}">

    <button type="submit">ðŸ’¾ Salva Vettura</button>
</form>

<a class="button" href="/vetture">ðŸ”™ Torna allâ€™elenco vetture</a>

<script>
const modelli = {{ modelli_json|safe }};

document.getElementById('marca').addEventListener('change', function() {
    const marcaSelezionata = this.value;
    const selectModello = document.getElementById('modello_id');
    selectModello.innerHTML = '<option value="">-- Seleziona modello --</option>';

    if (!marcaSelezionata) {
        selectModello.disabled = true;
        return;
    }

    modelli.filter(m => m.marca === marcaSelezionata).forEach(m => {
        const option = document.createElement('option');
        option.value = m.id;
        option.textContent = m.modello + (m.versione ? ` (${m.versione})` : '');
        option.dataset.cilindrata = m.cilindrata || '';
        option.dataset.kw = m.kw || '';
        option.dataset.carburante = m.carburante || '';
        selectModello.appendChild(option);
    });

    selectModello.disabled = false;
});
</script>

{% endblock %}
